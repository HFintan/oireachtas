<!DOCTYPE html>
<html lang="ga">
<head>
<meta charset="UTF-8" />
<title>Cruthaigh d'amchlár pearsanta le haghaidh Oireachtas '25</title>
<style>
body {
  font-family: sans-serif;
  max-width: none;
  margin: auto;
  padding: 2rem;
}
label {
  display: block;
  margin: 0.5rem 0;
}
#output {
  display: block;
  margin-top: 2rem;
  width: 100%;
  font-size: 12pt;
  line-height: 1.2;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
  background: white;
}
th, td {
  border: 1px solid #ccc;
  padding: 0.5rem;
  text-align: left;
  vertical-align: top;
}
th {
  background: #eee;
}
.day-heading {
  margin-top: 2rem;
  font-size: 1.2em;
  font-weight: bold;
}
#pdfButton {
  margin-top: 1rem;
  display: inline-block;
}
</style>
</head>
<body>

<h2>Cruthaigh d'amchlár pearsanta le haghaidh Oireachtas '25:</h2>

<form id="checklistForm">
  <div class="day-heading">Dé Céadaoin</div>
  <label data-color="189, 189, 189">
    <input type="checkbox" name="item" value="Dé Céadaoin||11:00||Comórtas na gCór||Comórtais do chóir bhunscoile||An Halla Mór, Bunurlár, ICC">
    11:00 <i>Comórtas na gCór</i> Comórtais do chóir bhunscoile <b>An Halla Mór, Bunurlár, ICC</b>
  </label>
  <label data-color="189, 189, 189">
    <input type="checkbox" name="item" value="Dé Céadaoin||12:30||Comórtas na gCór||Comórtais do chóir mheánscoile||An Halla Mór, Bunurlár, ICC">
    12:30 <i>Comórtas na gCór</i> Comórtais do chóir mheánscoile <b>An Halla Mór, Bunurlár, ICC</b>
  </label>
  <label data-color="189, 189, 189">
    <input type="checkbox" name="item" value="Dé Céadaoin||13:00||Oscailt Oifigiúil na Féile|| ||ICC">
    13:00 <i>Oscailt Oifigiúil na Féile</i> <b>ICC</b>
  </label>
</form>

<div id="output">
  <table>
    <thead>
      <tr>
        <th>Am</th><th>Teideal</th><th>Cur Síos</th><th>Suíomh</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be dynamically added here -->
    </tbody>
  </table>
</div>

<button id="pdfButton" onclick="exportToPDF()">Íoslódáil PDF</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
const outputTbody = document.querySelector("#output tbody");

// Example: dynamically populate table from form
document.querySelectorAll('#checklistForm input[type="checkbox"]').forEach(cb => {
  if(cb.checked) {
    const tr = document.createElement('tr');
    const [day,time,title,desc,place] = cb.value.split('||');

    tr.innerHTML = `
      <td>${time}</td>
      <td>${title}</td>
      <td>${desc}</td>
      <td style="background-color: rgb(${cb.parentElement.dataset.color});">${place}</td>
    `;
    outputTbody.appendChild(tr);
  }
});

function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("portrait", "mm", "a4");

  // Base64 image (example small PNG)
  const imgData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...'; // shorten for demo

  // Add image (smaller for mobile)
  const imgWidth = 150; 
  const imgHeight = 100;
  const imgX = 10;
  const imgY = 10;
  pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth, imgHeight);

  // Build table rows
  const rows = [];
  outputTbody.querySelectorAll("tr").forEach(tr => {
    const cells = tr.querySelectorAll("td");
    const row = [];
    cells.forEach((cell, index) => {
      if(index === 3) { // last column: Suíomh
        const bg = cell.style.backgroundColor.match(/\d+/g);
        row.push({
          content: cell.innerText.trim(),
          styles: { fillColor: bg ? bg.map(n=>parseInt(n)) : null }
        });
      } else {
        row.push(cell.innerText.trim());
      }
    });
    rows.push(row);
  });

  // Render table slightly after image to avoid mobile crash
  setTimeout(() => {
    pdf.autoTable({
      startY: imgY + imgHeight + 5, // below image
      head: [["Am","Teideal","Cur Síos","Suíomh"]],
      body: rows,
      margin: { top: 1, left: 1, right: 1 },
      styles: { fontSize: 8, cellPadding: 1 }
    });

    pdf.save("mOireachtas25.pdf");
  }, 50);
}
</script>
</body>
</html>
